<style>
/* Sticky Bottom Cart Bar */
.sticky-labor-cart {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1e3a8a 0%, #dc2626 100%);
  padding: 15px 20px;
  z-index: 1000;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  opacity: 1;
  visibility: visible;
}

.sticky-cart-content {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  gap: 20px;
}

.sticky-product-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.sticky-product-image {
  width: 60px;
  height: 60px;
  border-radius: 10px;
  overflow: hidden;
  background: white;
  padding: 3px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.sticky-product-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.sticky-product-details h4 {
  color: white;
  font-size: 14px;
  font-weight: 600;
  margin: 0 0 4px 0;
  line-height: 1.3;
  max-width: 200px;
}

.sticky-sku {
  color: #ffc107;
  font-size: 11px;
  font-weight: 500;
}

.sticky-price-timer-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.sticky-sale-badge {
  background: #ffc107;
  color: #1e3a8a;
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sticky-price-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.sticky-original-price {
  color: #ffffff80;
  text-decoration: line-through;
  font-size: 12px;
}

.sticky-final-price {
  color: #ffc107;
  font-size: 24px;
  font-weight: 900;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.sticky-savings {
  color: #10b981;
  font-size: 11px;
  font-weight: 600;
  background: rgba(16, 185, 129, 0.15);
  padding: 2px 8px;
  border-radius: 8px;
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.sticky-timer {
  display: flex;
  align-items: center;
  gap: 8px;
}

.sticky-timer-label {
  color: #ffc107;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
}

.sticky-countdown {
  display: flex;
  gap: 3px;
}

.sticky-time-unit {
  background: rgba(255, 255, 255, 0.95);
  border: 1px solid #ffc107;
  border-radius: 6px;
  padding: 3px 5px;
  text-align: center;
  min-width: 22px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.sticky-time-unit span {
  display: block;
  font-size: 11px;
  font-weight: 900;
  color: #1e3a8a;
  line-height: 1;
}

.sticky-time-unit label {
  font-size: 7px;
  font-weight: 700;
  color: #dc2626;
  line-height: 1;
}

.sticky-cart-controls {
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: flex-end;
}

.sticky-variant-select {
  background: rgba(255, 255, 255, 0.95);
  border: 1px solid #1e3a8a;
  border-radius: 6px;
  padding: 4px 8px;
  font-size: 10px;
  color: #1e3a8a;
  font-weight: 600;
  min-width: 150px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.sticky-controls-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.sticky-quantity-controls {
  display: flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 8px;
  padding: 2px;
  gap: 2px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(30, 58, 138, 0.2);
}

.sticky-qty-btn {
  background: #1e3a8a;
  color: white;
  border: none;
  width: 24px;
  height: 24px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.sticky-qty-input {
  background: transparent;
  border: none;
  color: #1e3a8a;
  text-align: center;
  width: 35px;
  font-size: 12px;
  font-weight: 700;
  padding: 3px;
  outline: none;
}

.sticky-add-to-cart {
  background: linear-gradient(45deg, #10b981, #059669);
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  letter-spacing: 0.3px;
  min-width: 110px;
  justify-content: center;
}

.sticky-close {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.2s ease;
  position: absolute;
  top: 8px;
  right: 15px;
}

.sticky-close:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .sticky-cart-content {
    grid-template-columns: 1fr;
    gap: 15px;
    text-align: center;
  }

  .sticky-product-info {
    justify-content: center;
  }

  .sticky-price-timer-section {
    order: -1;
  }

  .sticky-cart-controls {
    align-items: center;
    width: 100%;
  }

  .sticky-controls-row {
    justify-content: center;
    width: 100%;
  }

  .sticky-product-details h4 {
    font-size: 13px;
    max-width: 250px;
  }

  .sticky-final-price {
    font-size: 20px;
  }

  .sticky-add-to-cart {
    flex: 1;
    max-width: 200px;
  }
}

@media (max-width: 480px) {
  .sticky-labor-cart {
    padding: 12px 15px;
  }

  .sticky-product-image {
    width: 50px;
    height: 50px;
  }

  .sticky-timer {
    display: none;
  }

  .sticky-controls-row {
    flex-direction: column;
    gap: 10px;
  }

  .sticky-quantity-controls {
    order: 1;
  }

  .sticky-add-to-cart {
    order: 2;
    width: 100%;
    max-width: none;
  }
}
</style>

<!-- Sticky Labor Day Cart Bar -->
<div class="sticky-labor-cart" id="stickyLaborCart">
  <button class="sticky-close" onclick="hideStickyCart()">Ã—</button>
  <div class="sticky-cart-content">
    <div class="sticky-product-info">
      <div class="sticky-product-image">
        {% if product.featured_image %}
          <img src="{{ product.featured_image | img_url: '100x100' }}" alt="{{ product.title }}">
        {% else %}
          <div style="color: #666; font-size: 20px; display: flex; align-items: center; justify-content: center; height: 100%;">ðŸ“¦</div>
        {% endif %}
      </div>
      <div class="sticky-product-details">
        <h4>{{ product.title | truncate: 50 }}</h4>
        <div class="sticky-sku">SKU: <span class="sticky-current-sku">{{ product.variants.first.sku }}</span></div>
      </div>
    </div>

    <div class="sticky-price-timer-section">
      <div class="sticky-sale-badge">Labour Special</div>
      <div class="sticky-price-display">
        <span class="sticky-original-price" id="stickyOriginalPrice">${{ product.price | money_without_currency }}</span>
        <span class="sticky-final-price" id="stickyFinalPrice">$0.00</span>
      </div>
      <div class="sticky-savings" id="stickySavings">You Save $0.00</div>

      <div class="sticky-timer">
        <div class="sticky-timer-label">Sale Ends:</div>
        <div class="sticky-countdown">
          <div class="sticky-time-unit">
            <span id="stickyDays">30</span>
            <label>D</label>
          </div>
          <div class="sticky-time-unit">
            <span id="stickyHours">22</span>
            <label>H</label>
          </div>
          <div class="sticky-time-unit">
            <span id="stickyMinutes">48</span>
            <label>M</label>
          </div>
        </div>
      </div>
    </div>

    <div class="sticky-cart-controls">
      <div class="sticky-variant-controls" id="stickyVariantSection">
        <select id="stickyVariantSelect" class="sticky-variant-select" onchange="syncVariantToMain()">
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>

      <div class="sticky-controls-row">
        <div class="sticky-quantity-controls">
          <button type="button" onclick="decreaseQuantity()" class="sticky-qty-btn">âˆ’</button>
          <input type="number" class="sticky-qty-input" id="stickyQuantity" value="1" min="1" readonly>
          <button type="button" onclick="increaseQuantity()" class="sticky-qty-btn">+</button>
        </div>

        <button class="sticky-add-to-cart" onclick="addToCartFromSticky()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
          </svg>
          Add to Cart
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Sticky Labor Day Cart Functionality
let stickyCartVisible = true; // Always visible now
let currentDiscountPercent = 20; // Default discount

// Update sticky cart prices based on promo ticker logic
function updateStickyPrices() {
  // Get current variant price
  const productSelect = document.getElementById('productSelect');
  if (!productSelect) return;

  const selectedOption = productSelect.options[productSelect.selectedIndex];
  const currentPrice = parseFloat(selectedOption.text.split('$')[1]?.replace(/[^\d.]/g, '') || '0');

  // Calculate discounted price (20% off for Labor Day)
  const discountedPrice = currentPrice * (1 - currentDiscountPercent / 100);
  const savings = currentPrice - discountedPrice;

  // Update sticky cart prices
  document.getElementById('stickyOriginalPrice').textContent = '$' + currentPrice.toFixed(2);
  document.getElementById('stickyFinalPrice').textContent = '$' + discountedPrice.toFixed(2);
  document.getElementById('stickySavings').textContent = 'You Save $' + savings.toFixed(2);
}

// Update sticky cart SKU when variant changes
function updateStickySKU() {
  const productSelect = document.getElementById('productSelect');
  if (!productSelect) return;

  const selectedOption = productSelect.options[productSelect.selectedIndex];
  const sku = selectedOption.getAttribute('data-sku') || '';

  document.querySelector('.sticky-current-sku').textContent = sku;
}

// Sticky cart countdown timer
function updateStickyCountdown() {
  const countDownDate = new Date('2025-09-30T23:59:59').getTime();
  const now = new Date().getTime();
  const distance = countDownDate - now;

  if (distance > 0) {
    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

    document.getElementById('stickyDays').textContent = String(days).padStart(2, '0');
    document.getElementById('stickyHours').textContent = String(hours).padStart(2, '0');
    document.getElementById('stickyMinutes').textContent = String(minutes).padStart(2, '0');
  } else {
    document.getElementById('stickyDays').textContent = '00';
    document.getElementById('stickyHours').textContent = '00';
    document.getElementById('stickyMinutes').textContent = '00';
  }
}

// Populate sticky variant selector
function populateStickyVariants() {
  const mainSelect = document.getElementById('productSelect');
  const stickySelect = document.getElementById('stickyVariantSelect');
  const stickyVariantSection = document.getElementById('stickyVariantSection');

  if (mainSelect && stickySelect) {
    // Clear existing options
    stickySelect.innerHTML = '';

    // Copy options from main selector
    Array.from(mainSelect.options).forEach(option => {
      const newOption = option.cloneNode(true);
      stickySelect.appendChild(newOption);
    });

    // Show variant section if there are multiple options
    if (stickySelect.options.length > 1) {
      stickyVariantSection.style.display = 'block';
    }

    // Sync initial selection
    stickySelect.value = mainSelect.value;
  }
}

// Sync variant selection to main form
function syncVariantToMain() {
  const stickySelect = document.getElementById('stickyVariantSelect');
  const mainSelect = document.getElementById('productSelect');

  if (mainSelect && stickySelect) {
    mainSelect.value = stickySelect.value;

    // Trigger change event on main selector to update pricing
    const changeEvent = new Event('change', { bubbles: true });
    mainSelect.dispatchEvent(changeEvent);

    // Update sticky prices and SKU
    updateStickyPrices();
    updateStickySKU();

    // Dispatch event for promo ticker
    document.dispatchEvent(new CustomEvent('stickyVariantChange', {
      detail: { variantId: stickySelect.value }
    }));
  }
}

// Sync variant selection from main form
function syncVariantFromMain() {
  const mainSelect = document.getElementById('productSelect');
  const stickySelect = document.getElementById('stickyVariantSelect');

  if (mainSelect && stickySelect) {
    stickySelect.value = mainSelect.value;
    updateStickyPrices();
    updateStickySKU();

    // Dispatch event for promo ticker
    document.dispatchEvent(new CustomEvent('stickyVariantChange', {
      detail: { variantId: mainSelect.value }
    }));
  }
}

// Sync quantity with main product form
function syncQuantityToMain() {
  const stickyQty = document.getElementById('stickyQuantity');
  const mainQty = document.getElementById('Quantity');

  if (mainQty && stickyQty) {
    mainQty.value = stickyQty.value;
    // Trigger change event to update any dependent calculations
    const changeEvent = new Event('change', { bubbles: true });
    mainQty.dispatchEvent(changeEvent);
  }
}

// Sync quantity from main form
function syncQuantityFromMain() {
  const mainQty = document.getElementById('Quantity');
  const stickyQty = document.getElementById('stickyQuantity');

  if (mainQty && stickyQty) {
    const currentMainQty = parseInt(mainQty.value) || 1;
    const currentStickyQty = parseInt(stickyQty.value) || 1;

    // Only update if values are different
    if (currentMainQty !== currentStickyQty) {
      stickyQty.value = currentMainQty;
    }
  }
}

// Increase quantity
function increaseQuantity() {
  const stickyQty = document.getElementById('stickyQuantity');
  if (stickyQty) {
    const currentValue = parseInt(stickyQty.value) || 1;
    stickyQty.value = currentValue + 1;
    syncQuantityToMain();
  }
}

// Decrease quantity
function decreaseQuantity() {
  const stickyQty = document.getElementById('stickyQuantity');
  if (stickyQty) {
    const currentValue = parseInt(stickyQty.value) || 1;
    if (currentValue > 1) {
      stickyQty.value = currentValue - 1;
      syncQuantityToMain();
    }
  }
}

// Add to cart from sticky bar
function addToCartFromSticky() {
  const stickyQty = document.getElementById('stickyQuantity');
  const stickySelect = document.getElementById('stickyVariantSelect');
  const mainQty = document.getElementById('Quantity');
  const mainSelect = document.getElementById('productSelect');

  // Sync everything first
  if (mainQty && stickyQty) {
    mainQty.value = stickyQty.value;
  }

  if (mainSelect && stickySelect) {
    mainSelect.value = stickySelect.value;
  }

  // Trigger the main add to cart button
  const mainAddToCartBtn = document.getElementById('AddToCart');
  if (mainAddToCartBtn) {
    // Create a custom event to ensure proper quantity is used
    const customEvent = new CustomEvent('stickyAddToCart', {
      detail: { 
        quantity: stickyQty ? parseInt(stickyQty.value) : 1,
        variantId: stickySelect ? stickySelect.value : (mainSelect ? mainSelect.value : null)
      }
    });

    document.dispatchEvent(customEvent);

    // Also click the main button as fallback
    mainAddToCartBtn.click();

    // Show success animation
    const stickyBtn = document.querySelector('.sticky-add-to-cart');
    const originalText = stickyBtn.innerHTML;
    stickyBtn.innerHTML = 'âœ“ Added!';
    stickyBtn.style.background = 'linear-gradient(45deg, #10b981, #059669)';

    setTimeout(() => {
      stickyBtn.innerHTML = originalText;
    }, 2000);
  }
}

// Hide sticky cart
function hideStickyCart() {
  const stickyCart = document.getElementById('stickyLaborCart');
  stickyCart.style.display = 'none';
  stickyCartVisible = false;

  // Only hide for current page session, will show again on page refresh
}

// Initialize sticky cart
function initStickyLaborCart() {
  // Always show the cart on page load - ignore previous hide preference
  const stickyCart = document.getElementById('stickyLaborCart');
  if (stickyCart) {
    stickyCart.style.display = 'block';
  }

  // Wait a bit for the main form to be fully loaded
  setTimeout(() => {
    // Populate variant selector
    populateStickyVariants();

    // Initial sync from main form
    syncQuantityFromMain();
    syncVariantFromMain();

    // Update prices initially
    updateStickyPrices();
    updateStickySKU();

    // Start countdown
    updateStickyCountdown();
    setInterval(updateStickyCountdown, 60000); // Update every minute

    // Listen for variant changes on main form
    const productSelect = document.getElementById('productSelect');
    if (productSelect) {
      productSelect.addEventListener('change', () => {
        setTimeout(() => {
          syncVariantFromMain();
          updateStickyPrices();
          updateStickySKU();
        }, 100);
      });
    }

    // Listen for quantity changes on main form
    const mainQty = document.getElementById('Quantity');
    if (mainQty) {
      mainQty.addEventListener('change', () => {
        syncQuantityFromMain();
      });
      mainQty.addEventListener('input', () => {
        syncQuantityFromMain();
      });
    }

    // Force initial update
    setTimeout(() => {
      syncQuantityFromMain();
      syncVariantFromMain();
      updateStickyPrices();
    }, 500);
  }, 200);
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', initStickyLaborCart);
</script>